<html>
<head>
     <meta charset="UTF-8">
   <title>Chat</title>
   
   <link rel="stylesheet" type="text/css" href="style.css" />
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
<script type="text/javascript">

$(document).ready(function(){

		$.ajax({
 		url: "/get/All/Users",
		type: "GET",
		contentType: "application/json",
		success: function (data, textStatus, jqXHR) {
			var tableContent = "";
			 for ( var i in data ) {
                        tableContent += "<option value="+data[i]._id+">"+data[i].name+"</option>";
                    }		
			$("#allowedUsers").html(tableContent);

					     
		},
		
	});
				


})
					
</script>
</head>
<body>
<div class="container">
	<section id="content">
		<form id="myform" action="/Rooms" method="POST">
			<label for="Name">Name</label>
  <input type="text" class="form-control" id="name" name="nom"/><br/>
<label for="AuthorizedUser">Authorized Users</label>
  <select multiple class="form-control" id="allowedUsers"></select>
  <input class="btn btn-default" type="submit" id="roomSubmit" value="Submit"/>
</form>

<script type="text/javascript">
   $("#myform").bind("submit", function(evt) {
   
   	$('#allowedUsers :selected').each(function(i, selected){ 
  				//alert( $(selected).val()); 
  				
  				 $.ajax({
				url: "Users/update/"+$(selected).val()+"/"+$('#name').val(),
				type: "PUT",
				contentType: "application/json",
				//data: JSON.stringify(
				//	{
				//		_id:"54cb5afbc90c8961aafd01c1",
				///		$push: { rooms: 20 } 
				//	}
				//	),
				success: function (data, textStatus, jqXHR) {
					alert("added room");
				},
				error: function (jqXHR, textStatus, errorThrown) {
					alert("error add room");
			
				}
			});
	});
   	
		  $.ajax({
				url: "/Rooms",
				type: "POST",
				contentType: "application/json",
				data: JSON.stringify({nom:$('#name').val()}),
				success: function (data, textStatus, jqXHR) {
					// do something with your data here.
					window.location.href = "/Rooms";
				},
				error: function (jqXHR, textStatus, errorThrown) {
					// likewise do something with your error here.
			
				}
			});
	  return false;
    });
</script>


		
		</div><!-- button -->
	</section><!-- content -->
</div><!-- container -->


</body>
</html>